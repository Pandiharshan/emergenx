import{u as S,r as n,A,j as e,L as N}from"./index-xrWeT0Kj.js";import{g as $}from"./triageService-pzd6z597.js";const L=()=>{const o=S(),{user:c,loading:d}=n.useContext(A),[l,p]=n.useState([]),[m,y]=n.useState(!0),[h,x]=n.useState(null),[C,v]=n.useState(0);n.useEffect(()=>{!d&&!c&&o("/login")},[c,d,o]);const u=async()=>{var s;try{y(!0),x(null);const t=(((s=(await $()).data)==null?void 0:s.history)||[]).sort((i,g)=>new Date(g.createdAt)-new Date(i.createdAt));p(t)}catch(a){x(a.message||"Failed to load triage history. Please try again.")}finally{y(!1)}};n.useEffect(()=>{c&&!d&&u()},[c,d]);const f=()=>{v(s=>s+1),u()},j=s=>{const a=new Date(s),t=Math.floor((new Date-a)/(1e3*60*60));if(t<1)return"Just now";if(t<24)return`${t} hour${t>1?"s":""} ago`;if(t<168){const i=Math.floor(t/24);return`${i} day${i>1?"s":""} ago`}else return a.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},b=s=>{const a={high:{icon:"ðŸ”´",color:"red",label:"High Priority"},medium:{icon:"ðŸŸ¡",color:"yellow",label:"Medium Priority"},low:{icon:"ðŸŸ¢",color:"green",label:"Low Priority"}};return a[s]||a.low},w=s=>{if(!s||s.length===0)return"low";const a=s.filter(t=>t.severity==="high").length,r=s.filter(t=>t.severity==="medium").length;return a>0?"high":r>0?"medium":"low"};return d?e.jsx("div",{className:"triage-history-container",children:e.jsxs("div",{className:"auth-loading",children:[e.jsx(N,{}),e.jsx("p",{children:"Verifying authentication..."})]})}):c?e.jsxs("div",{className:"triage-history-container",children:[e.jsxs("header",{className:"triage-history-header",children:[e.jsx("h1",{children:"Assessment History"}),e.jsx("p",{className:"history-subtitle",children:"Review your previous health assessments and recommendations"})]}),e.jsxs("main",{className:"triage-history-main",children:[m&&e.jsxs("div",{className:"loading-section",role:"status","aria-live":"polite",children:[e.jsx(N,{}),e.jsx("p",{children:"Loading your assessment history..."})]}),h&&!m&&e.jsxs("div",{className:"error-section",role:"alert","aria-live":"polite",children:[e.jsxs("div",{className:"error-message",children:[e.jsx("span",{className:"error-icon",children:"âš "}),e.jsxs("div",{className:"error-content",children:[e.jsx("h3",{children:"Unable to Load History"}),e.jsx("p",{children:h})]})]}),e.jsx("button",{onClick:f,className:"retry-btn","aria-label":"Retry loading triage history",children:"Try Again"})]}),!m&&!h&&l.length===0&&e.jsx("div",{className:"empty-state",role:"region","aria-labelledby":"empty-heading",children:e.jsxs("div",{className:"empty-content",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ“‹"}),e.jsx("h2",{id:"empty-heading",children:"No Assessment History"}),e.jsx("p",{children:"You haven't completed any health assessments yet."}),e.jsx("button",{onClick:()=>o("/triage"),className:"start-assessment-btn","aria-label":"Start your first health assessment",children:"Start Your First Assessment"})]})}),!m&&!h&&l.length>0&&e.jsxs("div",{className:"history-list",role:"main",children:[e.jsx("div",{className:"history-stats",children:e.jsxs("p",{className:"stats-text",children:["Showing ",l.length," assessment",l.length!==1?"s":""]})}),e.jsx("div",{className:"history-entries",children:l.map(s=>{var t;const a=w(s.symptoms),r=b(a);return e.jsxs("article",{className:"history-entry","aria-labelledby":`entry-${s._id}-heading`,children:[e.jsx("header",{className:"entry-header",children:e.jsxs("div",{className:"entry-date-severity",children:[e.jsx("h3",{id:`entry-${s._id}-heading`,className:"entry-date",children:j(s.createdAt)}),e.jsxs("div",{className:`severity-badge severity-${r.color}`,role:"img","aria-label":r.label,children:[e.jsx("span",{className:"severity-icon",children:r.icon}),e.jsx("span",{className:"severity-text",children:a})]})]})}),e.jsxs("section",{className:"entry-content",children:[e.jsxs("div",{className:"symptoms-section",children:[e.jsxs("h4",{className:"symptoms-heading",children:["Symptoms Reported (",((t=s.symptoms)==null?void 0:t.length)||0,")"]}),s.symptoms&&s.symptoms.length>0?e.jsx("ul",{className:"symptoms-list",role:"list",children:s.symptoms.map(i=>e.jsxs("li",{className:"symptom-item",role:"listitem",children:[e.jsx("span",{className:"symptom-name",children:i.name}),e.jsx("span",{className:`symptom-severity symptom-${i.severity}`,children:i.severity})]},i.id))}):e.jsx("p",{className:"no-symptoms",children:"No symptoms recorded"})]}),s.recommendation&&e.jsxs("div",{className:"recommendation-section",children:[e.jsx("h4",{className:"recommendation-heading",children:"Recommendation"}),e.jsxs("div",{className:"recommendation-content",children:[s.recommendation.urgency&&e.jsx("div",{className:`urgency-level urgency-${s.recommendation.urgency}`,children:e.jsxs("span",{className:"urgency-label",children:[s.recommendation.urgency.charAt(0).toUpperCase()+s.recommendation.urgency.slice(1)," Priority"]})}),e.jsx("p",{className:"recommendation-text",children:s.recommendation.message||s.recommendation.description}),s.recommendation.nextSteps&&e.jsxs("div",{className:"next-steps",children:[e.jsx("h5",{children:"Next Steps:"}),e.jsx("ul",{children:s.recommendation.nextSteps.map((i,g)=>e.jsx("li",{children:i},g))})]})]})]}),e.jsx("div",{className:"entry-footer",children:e.jsxs("div",{className:"entry-meta",children:[s.triageId&&e.jsxs("span",{className:"triage-id",children:["Assessment ID: ",s.triageId]}),e.jsx("button",{onClick:()=>{console.log("Navigating to:",`/triage/results/${s._id}`),o(`/triage/results/${s._id}`)},className:"view-details-btn","aria-label":`View detailed results for assessment from ${j(s.createdAt)}`,children:"View Details"})]})})]})]},s._id)})})]})]}),!m&&!h&&l.length>0&&e.jsx("div",{className:"new-assessment-cta",role:"complementary",children:e.jsxs("div",{className:"cta-content",children:[e.jsx("h3",{children:"Need Another Assessment?"}),e.jsx("p",{children:"Start a new health assessment if your symptoms have changed."}),e.jsx("button",{onClick:()=>o("/triage"),className:"new-assessment-btn","aria-label":"Start a new health assessment",children:"Start New Assessment"})]})}),e.jsx("div",{className:"emergency-notice",role:"complementary",children:e.jsxs("div",{className:"emergency-content",children:[e.jsx("span",{className:"emergency-icon",children:"ðŸš¨"}),e.jsxs("div",{className:"emergency-text",children:[e.jsx("strong",{children:"Emergency?"})," If you are experiencing a medical emergency, call 911 or go to your nearest emergency room immediately."]})]})})]}):null};export{L as default};
