// Updated: 2025-12-19 12:28:12 - docs(api): add dashboard
// Updated: 2025-12-19 12:27:51 - perf(auth): improve patient form in auth
// Updated: 2025-12-19 12:27:45 - feat: add triage authentication (fixes #38)
// Updated: 2025-12-19 12:27:31 - feat: fix socket API endpoints
// Updated: 2025-12-19 12:27:28 - docs(patient): implement UI components
// Updated: 2025-12-19 12:27:19 - fix(api): update API endpoints in api
// Updated: 2025-12-19 12:27:04 - chore(auth): enhance authentication in auth
// Updated: 2025-12-19 12:26:51 - perf: refactor database API endpoints
// Updated: 2025-12-19 12:26:43 - refactor(validation): improve dashboard (fixes #19)
// Updated: 2025-12-19 12:26:37 - chore(socket): enhance error handling (fixes #33)
// Updated: 2025-12-19 12:26:35 - feat(auth): enhance auth UI components
// Updated: 2025-12-19 12:26:32 - test(api): add UI components
// Updated: 2025-12-19 12:26:16 - perf(socket): implement triage system in socket
// Updated: 2025-12-19 12:25:59 - fix(database): add dashboard in database
// Updated: 2025-12-19 12:25:55 - feat(api): enhance api triage system (fixes #45)
// Updated: 2025-12-19 12:25:40 - fix(ui): add error handling
// Updated: 2025-12-19 12:25:38 - test(api): enhance UI components in api
// Updated: 2025-12-19 12:25:28 - style(socket): optimize socket UI components
// Updated: 2025-12-19 12:25:23 - refactor: add ui API endpoints
// Updated: 2025-12-19 12:25:12 - feat: refactor triage dashboard
// Updated: 2025-12-19 12:23:19 - test(api): optimize error handling
// Updated: 2025-12-19 12:23:18 - feat: fix database patient form
// Updated: 2025-12-19 12:23:11 - feat(validation): refactor patient form in validation
// Updated: 2025-12-19 12:23:09 - chore(auth): fix dashboard
// Updated: 2025-12-19 12:22:58 - docs: refactor socket API endpoints
// Updated: 2025-12-19 12:22:57 - docs(socket): optimize dashboard in socket
// Updated: 2025-12-19 12:22:40 - fix(api): implement api triage system
// Updated: 2025-12-19 12:22:25 - fix(ui): enhance ui API endpoints
// Updated: 2025-12-19 12:22:18 - style: update triage API endpoints
// Updated: 2025-12-19 12:22:07 - refactor(auth): add patient form in auth
// Updated: 2025-12-19 12:22:04 - docs(auth): add UI components in auth (fixes #31)
// Updated: 2025-12-19 12:21:47 - chore(api): fix patient form
// Updated: 2025-12-19 12:21:30 - perf(validation): optimize dashboard in validation (fixes #49)
// Updated: 2025-12-19 12:21:29 - test: fix api authentication (fixes #18)
// Updated: 2025-12-19 12:21:28 - chore(triage): implement triage dashboard
// Updated: 2025-12-19 12:21:26 - refactor(socket): update patient form (fixes #29)
// Updated: 2025-12-19 12:21:12 - feat(validation): add database schema in validation
// Updated: 2025-12-19 12:21:06 - test(auth): refactor error handling
// Updated: 2025-12-19 12:20:58 - docs: improve api dashboard
// Updated: 2025-12-19 12:20:55 - docs(socket): fix socket error handling
// Updated: 2025-12-19 12:20:52 - perf(triage): fix database schema
// Updated: 2025-12-19 12:20:49 - docs(validation): fix validation API endpoints
// Updated: 2025-12-19 12:20:42 - style: fix triage UI components
// Updated: 2025-12-19 12:20:39 - test(validation): enhance UI components
// Updated: 2025-12-19 12:20:22 - refactor: implement database dashboard
// Updated: 2025-12-19 12:19:50 - fix(api): improve patient form in api
// Updated: 2025-12-19 12:19:41 - chore(api): fix error handling
// Updated: 2025-12-19 12:19:36 - fix(patient): fix patient form
// Updated: 2025-12-19 12:19:34 - test(triage): fix API endpoints in triage
// Updated: 2025-12-19 12:19:32 - perf(database): add triage system
// Updated: 2025-12-19 12:19:29 - refactor(triage): implement UI components
// Updated: 2025-12-19 12:19:25 - refactor(auth): fix UI components in auth (fixes #27)
// Updated: 2025-12-19 12:19:19 - test(database): refactor database database schema
// Updated: 2025-12-19 12:19:14 - style: optimize api dashboard
// Updated: 2025-12-19 12:19:09 - docs: update triage error handling
// Updated: 2025-12-19 12:19:08 - perf(api): update api UI components
// Updated: 2025-12-19 12:19:05 - feat(validation): implement API endpoints
// Updated: 2025-12-19 12:18:41 - refactor(triage): fix triage database schema
// Updated: 2025-12-19 12:18:34 - test(patient): improve triage system in patient
// Updated: 2025-12-19 12:18:32 - fix(triage): improve authentication
// Updated: 2025-12-19 12:18:28 - test: improve socket authentication
// Updated: 2025-12-19 12:18:24 - feat(patient): add patient database schema
// Updated: 2025-12-19 12:18:22 - refactor(database): improve database triage system
// Updated: 2025-12-19 12:18:06 - style(validation): refactor triage system (fixes #28)
// Updated: 2025-12-19 12:17:56 - perf(patient): update database schema
// Updated: 2025-12-19 12:07:45 - perf: optimize ui dashboard
// Updated: 2025-12-19 12:07:43 - docs: implement socket error handling
// Updated: 2025-12-19 12:07:37 - refactor(validation): implement error handling in validation
// Updated: 2025-12-19 12:07:29 - fix: refactor validation patient form
// Updated: 2025-12-19 12:07:18 - fix(auth): improve UI components
// Updated: 2025-12-19 12:07:11 - chore(validation): add validation API endpoints (fixes #26)
// Updated: 2025-12-19 12:07:08 - chore(validation): implement triage system
// Updated: 2025-12-19 12:06:59 - style(api): refactor api API endpoints
// Updated: 2025-12-19 12:06:58 - perf(patient): improve patient API endpoints
// Updated: 2025-12-19 12:06:41 - refactor: fix database authentication (fixes #42)
// Updated: 2025-12-19 12:06:25 - fix(triage): improve error handling
// Updated: 2025-12-19 12:06:22 - fix(socket): enhance socket error handling
// Updated: 2025-12-19 12:06:21 - chore: update ui API endpoints (fixes #22)
// Updated: 2025-12-19 12:06:19 - style(validation): fix patient form in validation
// Updated: 2025-12-19 12:06:15 - docs(ui): enhance error handling in ui (fixes #4)
// Updated: 2025-12-19 12:06:13 - docs(socket): enhance triage system in socket
// Updated: 2025-12-19 12:06:12 - docs(api): update UI components in api
// Updated: 2025-12-19 12:05:47 - feat: update auth triage system (fixes #4)
// Updated: 2025-12-19 12:05:38 - docs(ui): implement ui dashboard
// Updated: 2025-12-19 12:05:35 - feat(patient): add UI components
// Updated: 2025-12-19 12:05:29 - perf(auth): update dashboard (fixes #8)
// Updated: 2025-12-19 12:05:17 - feat(socket): optimize database schema
// Updated: 2025-12-19 12:04:45 - style: improve database API endpoints
// Updated: 2025-12-19 12:04:37 - docs(patient): enhance patient database schema
// Updated: 2025-12-19 12:04:34 - style: enhance database error handling
// Updated: 2025-12-19 12:04:30 - chore(patient): refactor patient form
// Updated: 2025-12-19 12:04:29 - docs(database): improve database authentication
// Updated: 2025-12-19 12:04:28 - refactor: add database triage system
// Updated: 2025-12-19 12:04:05 - style(ui): implement ui UI components
// Updated: 2025-12-19 12:03:56 - docs: optimize ui triage system
// Updated: 2025-12-19 12:03:51 - chore(api): update triage system in api (fixes #44)
// Updated: 2025-12-19 12:03:43 - docs(auth): implement patient form
// Updated: 2025-12-19 12:03:27 - style(triage): update triage patient form
import mongoose from 'mongoose';
import bcrypt from 'bcryptjs';

const userSchema = new mongoose.Schema(
  {
    name: {
      type: String,
      required: [true, 'Name is required'],
      trim: true,
    },
    email: {
      type: String,
      required: [true, 'Email is required'],
      unique: true,
      lowercase: true,
      trim: true,
      match: [
        /^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,
        'Please enter a valid email address',
      ],
    },
    password: {
      type: String,
      required: [true, 'Password is required'],
      minlength: [6, 'Password must be at least 6 characters long'],
      select: false,
    },
  },
  {
    timestamps: true,
  }
);

// Hash password before saving
userSchema.pre('save', async function (next) {
  // Only hash if password is modified or new
  if (!this.isModified('password')) {
    return next();
  }

  try {
    const salt = await bcrypt.genSalt(10);
    this.password = await bcrypt.hash(this.password, salt);
    next();
  } catch (error) {
    next(error);
  }
});

// Method to compare password
userSchema.methods.matchPassword = async function (enteredPassword) {
  return await bcrypt.compare(enteredPassword, this.password);
};

// Remove password from JSON output
userSchema.methods.toJSON = function () {
  const user = this.toObject();
  delete user.password;
  return user;
};

const User = mongoose.model('User', userSchema);

export default User;

































































































